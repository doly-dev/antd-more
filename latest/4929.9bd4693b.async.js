"use strict";(self.webpackChunkantd_more=self.webpackChunkantd_more||[]).push([[4929],{94929:function(t,e,n){n.d(e,{Z:function(){return x}});var i=n(96050),r=n(61644),o=n(46465);var s=function(t){var e=(0,o.Z)(t),n=(0,r.useCallback)((function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var i=e.current;return null==i?void 0:i.apply(void 0,t)}),[]);return n},u=n(36914),c=n(57717),a=n.n(c),l=n(75327),h={},p={getItem:function(t){return h[t]||null},setItem:function(t,e){h[t]=e},removeItem:function(t){delete h[t]}};var f=1,d="cache2_";function v(t,e){var n="string"==typeof t&&t?t:"".concat(Math.random().toString(16).substring(2,8),"_").concat(f++);return("string"==typeof e?e:d)+n}var y=new(function(t){function e(e,n){var r,o,s=t.call(this)||this;return"string"==typeof e?r=e:"object"===a()(e)&&(o=e),o||"object"!==a()(n)||(o=n),s.options=(0,i.pi)({max:-1,stdTTL:0,storage:p,maxStrategy:"limited",checkperiod:0,needParsed:"boolean"==typeof(null==o?void 0:o.needParsed)?o.needParsed:!!(null==o?void 0:o.storage),prefix:d},o),s.options.storage!==p&&(!function(t){try{var e="object"===a()(t)&&null!==t&&!!t.setItem&&!!t.getItem&&!!t.removeItem;if(e){var n=v();if(t.setItem(n,"1"),"1"!==t.getItem(n))return!1;t.removeItem(n)}return e}catch(t){return console.error("[cache2] The current custom storage is not supported. The default memory cache will be used."),!1}}(s.options.storage)?(s.options.storage=p,s.options.needParsed=!1):r||(r="default")),s.cacheKey=v(r,s.options.prefix),s.startCheckperiod(),s}return(0,i.ZT)(e,t),e.prototype._check=function(t,e){var n=!0;return 0!==e.t&&e.t<Date.now()&&(n=!1,this.del(t),this.emit("expired",t,e.v)),n},e.prototype._wrap=function(t,e){var n=Date.now(),i="number"==typeof e?e:this.options.stdTTL;return{v:t,t:i>0?n+i:0,n:n}},e.prototype._isLimited=function(t){return this.options.max>-1&&t>=this.options.max},e.prototype._getReplaceKey=function(t,e){var n=t[0];return t.forEach((function(t){(e[t].t<e[n].t||e[t].t===e[n].t&&e[t].n<e[n].n)&&(n=t)})),n},e.prototype._parse=function(t){if(!this.options.needParsed)return t;try{return JSON.parse(t,this.options.reviver)}catch(e){return t}},e.prototype._stringify=function(t){return this.options.needParsed?JSON.stringify(t,this.options.replacer):t},Object.defineProperty(e.prototype,"cacheValues",{get:function(){return this._parse(this.options.storage.getItem(this.cacheKey))||{}},enumerable:!1,configurable:!0}),e.prototype.setCacheValues=function(t){this.options.storage.setItem(this.cacheKey,this._stringify(t))},e.prototype.get=function(t){var e=this.cacheValues[t];if(e&&this._check(t,e))return e.v},e.prototype.mget=function(t){var e=this,n={};if(!Array.isArray(t))return n;var i=this.cacheValues;return t.forEach((function(t){var r=i[t];r&&e._check(t,r)&&(n[t]=r.v)})),n},e.prototype.getAll=function(){var t=Object.keys(this.cacheValues);return this.mget(t)},e.prototype.set=function(t,e,n){if(0===this.options.max)return!1;var i=this.cacheValues,r=Object.keys(i);if(!i[t]&&this._isLimited(r.length)){var o=this.keys();if(this._isLimited(o.length)){if("replaced"!==this.options.maxStrategy)return!1;var s=this._getReplaceKey(o,i);this.del(s)}}return i[t]=this._wrap(e,n),this.setCacheValues(i),this.emit("set",t,i[t].v),!0},e.prototype.mset=function(t){var e=this,n=!0;return t.forEach((function(t){var i=e.set(t.key,t.value,t.ttl);n&&!i&&(n=!1)})),n},e.prototype.del=function(t){var e=this,n=this.cacheValues,i=0;return(Array.isArray(t)?t:[t]).forEach((function(t){if(n[t]){i++;var r=n[t];delete n[t],e.emit("del",t,r.v)}})),i>0&&this.setCacheValues(n),i},e.prototype.clear=function(){this.options.storage.removeItem(this.cacheKey)},e.prototype.keys=function(){var t=this,e=this.cacheValues;return Object.keys(e).filter((function(n){return t._check(n,e[n])}))},e.prototype.has=function(t){var e=this.cacheValues[t];return!(!e||!this._check(t,e))},e.prototype.take=function(t){var e,n=this.cacheValues[t];return n&&this._check(t,n)&&(e=n.v,this.del(t)),e},e.prototype.ttl=function(t,e){var n=this.cacheValues,i=n[t];return!(!i||!this._check(t,i))&&(n[t]=this._wrap(i.v,e),!0)},e.prototype.getTtl=function(t){var e=this.cacheValues,n=e[t];if(n&&this._check(t,n))return e[t].t},e.prototype.getLastModified=function(t){var e=this.cacheValues,n=e[t];if(n&&this._check(t,n))return e[t].n},e.prototype.startCheckperiod=function(){var t=this;this.keys(),this.options.checkperiod>0&&(clearTimeout(this._checkTimeout),this._checkTimeout=setTimeout((function(){t.startCheckperiod()}),this.options.checkperiod))},e.prototype.stopCheckperiod=function(){clearTimeout(this._checkTimeout)},e}(l.Z))({stdTTL:3e5}),m=function(t){return y.get(t)},g=function(t,e,n){y.set(t,e,n)},b=n(37850);var T=n(92371);function k(){return"undefined"==typeof document||void 0===document.visibilityState||"hidden"!==document.visibilityState}var _=[];var I=!1;if("undefined"!=typeof window&&window.addEventListener&&!I){window.addEventListener("visibilitychange",(function(){if(k())for(var t=0;t<_.length;t++){(0,_[t])()}}),!1),I=!0}var w=function(t){return _.push(t),function(){var e=_.indexOf(t);_.splice(e,1)}},V=[];var O=!1;if("undefined"!=typeof window&&window.addEventListener&&!O){var C=function(){if(k()&&("undefined"==typeof navigator||void 0===navigator.onLine||navigator.onLine))for(var t=0;t<V.length;t++){(0,V[t])()}};window.addEventListener("visibilitychange",C,!1),window.addEventListener("focus",C,!1),O=!0}var E=function(t){return V.push(t),function(){var e=V.indexOf(t);V.splice(e,1)}},L={},P=function(t,e){return e&&L[e]?L[e]:e?(L[e]=t().then((function(t){return delete L[e],t})).catch((function(t){return delete L[e],Promise.reject(t)})),L[e]):t()},F=function(){function t(t,e){this.params=[],this.pollingWhenVisibleFlag=!1,this.pollingTimer=null,this.counter=1,this.destroyed=!1,this.async=t,this.options=(0,i.pi)({cacheTime:3e5,persisted:!1,pollingWhenHidden:!0,refreshOnWindowFocus:!1,focusTimespan:5e3},e),this.unsubscribes=[],this.init()}return t.prototype.init=function(){var t,e,n,i=this.options,r=i.pollingInterval,o=i.refreshOnWindowFocus,s=i.focusTimespan;if(this.updateDebounce(),r&&this.unsubscribes.push(w(this.rePolling.bind(this))),o){var u=(t=this.refresh.bind(this),e=s,n=!1,function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];n||(n=!0,t.apply(void 0,i),setTimeout((function(){n=!1}),e))});this.unsubscribes.push(E(u))}},t.prototype.updateDebounce=function(){var t,e,n,i=this.options,r=i.debounceInterval,o=i.throttleInterval;this.debounce="number"==typeof r&&r>0?(t=this._run,void 0===(e=r)&&(e=0),void 0===n&&(n=!1),(0,b.Z)(t,e,n)):void 0,this.throttle="number"==typeof o&&o>0?(0,T.Z)(this._run,o):void 0},t.prototype.rePolling=function(){this.pollingWhenVisibleFlag&&(this.pollingWhenVisibleFlag=!1,this.refresh())},t.prototype.afterUpdateOptions=function(t,e){void 0===e&&(e={}),("debounceInterval"in e&&e.debounceInterval!==t.debounceInterval||"throttleInterval"in e&&e.throttleInterval!==t.throttleInterval)&&this.updateDebounce()},t.prototype.updateOptions=function(t){var e=this.options,n=(0,i.pi)((0,i.pi)({},this.options),t);this.options=n,this.afterUpdateOptions(e,n)},t.prototype._run=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this.pollingTimer&&clearTimeout(this.pollingTimer);var i=this.counter;this.params=e;var r=this.options,o=r.cacheKey,s=r.cacheTime,u=r.persisted,c=r.formatResult,a=r.onSuccess,l=r.onError,h=r.onFinally,p=r.onBefore,f=r.pollingWhenHidden,d=r.pollingInterval;return null==p||p(e),new Promise((function(n,r){if(o&&u){var p=m(o);if(p&&i===t.counter)return void Promise.resolve().then((function(){null==a||a(p,e),n(p)})).finally((function(){null==h||h()}))}P((function(){return t.async.apply(t,e)}),o).then((function(r){if(i===t.counter){var u="function"==typeof c?c(r,e):r;o&&g(o,u,s),null==a||a(u,e),n(u)}})).catch((function(n){i===t.counter&&(null==l||l(n,e),r(n))})).finally((function(){if(i===t.counter&&(null==h||h(),d)){if(!k()&&!f)return void(t.pollingWhenVisibleFlag=!0);t.pollingTimer=setTimeout((function(){t.run.apply(t,e)}),d)}}))}))},t.prototype.run=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this.debounce?(this.debounce.apply(this,t),Promise.resolve(null)):this.throttle?(this.throttle.apply(this,t),Promise.resolve(null)):(this.counter+=1,this._run.apply(this,t))},t.prototype.refresh=function(){return this.run.apply(this,this.params)},t.prototype.cancel=function(){this.debounce&&this.debounce.cancel(),this.throttle&&this.throttle.cancel(),this.pollingTimer&&(clearTimeout(this.pollingTimer),this.pollingTimer=null),this.counter+=1},t.prototype.destroy=function(t){void 0===t&&(t=!0),t&&this.cancel(),this.destroyed||(this.destroyed=!0,this.unsubscribes.forEach((function(t){return t()})),this.unsubscribes=[])},t.prototype.resume=function(){this.destroyed&&(this.destroyed=!1,this.init())},t}(),W=F,S=function(){};var x=function(t,e){var n=e||{},c=n.autoRun,a=void 0===c||c,l=n.refreshDeps,h=void 0===l?[]:l,p=n.defaultParams,f=n.loadingDelay,d=n.__INTERNAL_FORMAT__,v=n.defaultLoading,y=void 0!==v&&v,g=n.initialData,b=n.cacheKey,T=void 0===b?"":b,k=n.cacheTime,_=void 0===k?3e5:k,I=n.persisted,w=void 0!==I&&I,V=n.onSuccess,O=void 0===V?S:V,C=n.onError,E=void 0===C?S:C,L=n.onFinally,P=void 0===L?S:L,F=n.onBefore,x=void 0===F?S:F,A=n.pollingInterval,R=void 0===A?0:A,K=n.pollingWhenHidden,Z=void 0===K||K,j=n.refreshOnWindowFocus,D=void 0!==j&&j,H=n.focusTimespan,B=void 0===H?5e3:H,N=n.debounceInterval,M=n.throttleInterval,J=(0,i.CR)((0,r.useState)({params:[],loading:y,error:null,data:T?m(T):g}),2),U=J[0],q=J[1],z=(0,r.useRef)(null),G=s(t),Q=s(O),X=s(E),Y=s(P),$=s(x),tt=(0,o.Z)(d),et=(0,r.useCallback)((function(t){$(t),z.current&&clearTimeout(z.current),(T?m(T):void 0)&&w||(q((function(e){return(0,i.pi)((0,i.pi)({},e),{loading:!f,params:t})})),f&&(z.current=setTimeout((function(){q((function(t){return(0,i.pi)((0,i.pi)({},t),{loading:!0})}))}),f)))}),[T,f,$,w]),nt=(0,r.useCallback)((function(t,e){z.current&&clearTimeout(z.current),q((function(e){return(0,i.pi)((0,i.pi)({},e),{data:t,error:null,loading:!1})})),Q(t,e)}),[Q]),it=(0,r.useCallback)((function(t,e){z.current&&clearTimeout(z.current),q((function(e){return(0,i.pi)((0,i.pi)({},e),{error:t,loading:!1})})),X(t,e)}),[X]),rt=(0,r.useRef)();rt.current||(rt.current=new W(G,{cacheKey:T,cacheTime:_,persisted:w,formatResult:tt.current,onSuccess:nt,onError:it,onFinally:Y,onBefore:et,debounceInterval:N,throttleInterval:M,pollingInterval:R,pollingWhenHidden:Z,refreshOnWindowFocus:D,focusTimespan:B})),(0,u.Z)((function(){rt.current.updateOptions({cacheKey:T,cacheTime:_,persisted:w,formatResult:tt.current,onSuccess:nt,onError:it,onFinally:Y,onBefore:et,debounceInterval:N,throttleInterval:M,pollingInterval:R,pollingWhenHidden:Z,refreshOnWindowFocus:D,focusTimespan:B})}),[Q,X,T,_,w,N,M,Y,$,R,Z,D,B,nt,it,et]);var ot=(0,r.useCallback)((function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return rt.current.run.apply(rt.current,t)}),[]),st=(0,r.useCallback)((function(){return rt.current.refresh()}),[]),ut=(0,r.useCallback)((function(){rt.current.cancel(),z.current&&clearTimeout(z.current),q((function(t){return(0,i.pi)((0,i.pi)({},t),{loading:!1})}))}),[]);return(0,u.Z)((function(){a&&Array.isArray(h)&&h.length>0&&st()}),[a].concat(h)),(0,r.useEffect)((function(){if(a){var t=Array.isArray(p)?p:void 0!==p?[p]:[];ot.apply(void 0,t)}return rt.current.resume(),function(){ut(),rt.current.destroy(!1)}}),[]),(0,i.pi)((0,i.pi)({},U),{run:ot,cancel:ut,mutate:function(t){q("function"==typeof t?function(e){return(0,i.pi)((0,i.pi)({},e),{data:t(U.data)})}:function(e){return(0,i.pi)((0,i.pi)({},e),{data:t})})},refresh:st})}}}]);