"use strict";(self.webpackChunkantd_more=self.webpackChunkantd_more||[]).push([[5186],{35186:function(e,n,t){t.d(n,{Z:function(){return O}});var i=t(60984),r=t(978);var o=function(e){var n=(0,r.useRef)(e);n.current=e;var t=(0,r.useCallback)((function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=n.current;return null==r?void 0:r.apply(void 0,(0,i.ev)([],(0,i.CR)(e),!1))}),[n]);return t},u=t(35561),s=t(93886),a={},c=function(e){var n=a[e];if(n){var t=n.startTime,i=n.cacheTime,r=n.data;return(new Date).getTime()-t>=i?(n.timer&&clearTimeout(n.timer),void delete a[e]):r}},l=function(e,n,t){void 0===t&&(t=3e5),a[e]&&clearTimeout(a[e].timer);var i=setTimeout((function(){delete a[e]}),t);a[e]={data:n,timer:i,cacheTime:t,startTime:(new Date).getTime()}},d=t(40901),f=t.n(d),p=t(97554),h=t.n(p);function v(){return"undefined"==typeof document||void 0===document.visibilityState||"hidden"!==document.visibilityState}var m=[];var y=!1;if("undefined"!=typeof window&&window.addEventListener&&!y){window.addEventListener("visibilitychange",(function(){if(v())for(var e=0;e<m.length;e++){(0,m[e])()}}),!1),y=!0}var g=function(e){return m.push(e),function(){var n=m.indexOf(e);m.splice(n,1)}},b=[];var T=!1;if("undefined"!=typeof window&&window.addEventListener&&!T){var w=function(){if(v()&&("undefined"==typeof navigator||void 0===navigator.onLine||navigator.onLine))for(var e=0;e<b.length;e++){(0,b[e])()}};window.addEventListener("visibilitychange",w,!1),window.addEventListener("focus",w,!1),T=!0}var C=function(e){return b.push(e),function(){var n=b.indexOf(e);b.splice(n,1)}},R={},I=function(e,n){return n&&R[n]?R[n]:n?(R[n]=e().then((function(e){return delete R[n],e})).catch((function(e){return delete R[n],Promise.reject(e)})),R[n]):e()},F=function(){function e(e,n){this.params=[],this.pollingWhenVisibleFlag=!1,this.pollingTimer=null,this.counter=1,this.destroyed=!1,this.async=e,this.options=(0,i.pi)({cacheTime:3e5,persisted:!1,pollingWhenHidden:!0,refreshOnWindowFocus:!1,focusTimespan:5e3},n),this.unsubscribes=[],this.init()}return e.prototype.init=function(){var e,n,t,r=this.options,o=r.pollingInterval,u=r.refreshOnWindowFocus,s=r.focusTimespan;if(this.updateDebounce(),o&&this.unsubscribes.push(g(this.rePolling.bind(this))),u){var a=(e=this.refresh.bind(this),n=s,t=!1,function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];t||(t=!0,e.apply(void 0,(0,i.ev)([],(0,i.CR)(r),!1)),setTimeout((function(){t=!1}),n))});this.unsubscribes.push(C(a))}},e.prototype.updateDebounce=function(){var e=this.options,n=e.debounceInterval,t=e.throttleInterval;this.debounce="number"==typeof n&&n>0?f()(this._run,n):void 0,this.throttle="number"==typeof t&&t>0?h()(this._run,t):void 0},e.prototype.rePolling=function(){this.pollingWhenVisibleFlag&&(this.pollingWhenVisibleFlag=!1,this.refresh())},e.prototype.afterUpdateOptions=function(e,n){void 0===n&&(n={}),("debounceInterval"in n&&n.debounceInterval!==e.debounceInterval||"throttleInterval"in n&&n.throttleInterval!==e.throttleInterval)&&this.updateDebounce()},e.prototype.updateOptions=function(e){var n=this.options,t=(0,i.pi)((0,i.pi)({},this.options),e);this.options=t,this.afterUpdateOptions(n,t)},e.prototype._run=function(){for(var e=this,n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];this.pollingTimer&&clearTimeout(this.pollingTimer);var r=this.counter;this.params=n;var o=this.options,u=o.cacheKey,s=o.cacheTime,a=o.persisted,d=o.formatResult,f=o.onSuccess,p=o.onError,h=o.onFinally,m=o.onBefore,y=o.pollingWhenHidden,g=o.pollingInterval;return null==m||m(n),new Promise((function(t,o){if(u&&a){var m=c(u);if(m&&r===e.counter)return void Promise.resolve().then((function(){null==f||f(m,n),t(m)})).finally((function(){null==h||h()}))}I((function(){return e.async.apply(e,(0,i.ev)([],(0,i.CR)(n),!1))}),u).then((function(i){if(r===e.counter){var o="function"==typeof d?d(i,n):i;u&&l(u,o,s),null==f||f(o,n),t(o)}})).catch((function(t){r===e.counter&&(null==p||p(t,n),o(t))})).finally((function(){if(r===e.counter&&(null==h||h(),g)){if(!v()&&!y)return void(e.pollingWhenVisibleFlag=!0);e.pollingTimer=setTimeout((function(){e.run.apply(e,(0,i.ev)([],(0,i.CR)(n),!1))}),g)}}))}))},e.prototype.run=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return this.debounce?(this.debounce.apply(this,(0,i.ev)([],(0,i.CR)(e),!1)),Promise.resolve(null)):this.throttle?(this.throttle.apply(this,(0,i.ev)([],(0,i.CR)(e),!1)),Promise.resolve(null)):(this.counter+=1,this._run.apply(this,(0,i.ev)([],(0,i.CR)(e),!1)))},e.prototype.refresh=function(){return this.run.apply(this,(0,i.ev)([],(0,i.CR)(this.params),!1))},e.prototype.cancel=function(){this.debounce&&this.debounce.cancel(),this.throttle&&this.throttle.cancel(),this.pollingTimer&&(clearTimeout(this.pollingTimer),this.pollingTimer=null),this.counter+=1},e.prototype.destroy=function(e){void 0===e&&(e=!0),e&&this.cancel(),this.destroyed||(this.destroyed=!0,this.unsubscribes.forEach((function(e){return e()})),this.unsubscribes=[])},e.prototype.resume=function(){this.destroyed&&(this.destroyed=!1,this.init())},e}(),W=F,E=function(){};var O=function(e,n){var t=n||{},a=t.autoRun,l=void 0===a||a,d=t.refreshDeps,f=void 0===d?[]:d,p=t.defaultParams,h=t.loadingDelay,v=t.__INTERNAL_FORMAT__,m=t.defaultLoading,y=void 0!==m&&m,g=t.initialData,b=t.cacheKey,T=void 0===b?"":b,w=t.cacheTime,C=void 0===w?3e5:w,R=t.persisted,I=void 0!==R&&R,F=t.onSuccess,O=void 0===F?E:F,k=t.onError,_=void 0===k?E:k,L=t.onFinally,D=void 0===L?E:L,P=t.onBefore,S=void 0===P?E:P,A=t.pollingInterval,H=void 0===A?0:A,B=t.pollingWhenHidden,K=void 0===B||B,V=t.refreshOnWindowFocus,Z=void 0!==V&&V,x=t.focusTimespan,N=void 0===x?5e3:x,U=t.debounceInterval,j=t.throttleInterval,M=(0,i.CR)((0,r.useState)({params:[],loading:y,error:null,data:T?c(T):g}),2),q=M[0],z=M[1],G=(0,r.useRef)(null),J=o(e),Q=o(O),X=o(_),Y=o(D),$=o(S),ee=(0,s.Z)(v),ne=(0,r.useCallback)((function(e){$(e),G.current&&clearTimeout(G.current),(T?c(T):void 0)&&I||(z((function(n){return(0,i.pi)((0,i.pi)({},n),{loading:!h,params:e})})),h&&(G.current=setTimeout((function(){z((function(e){return(0,i.pi)((0,i.pi)({},e),{loading:!0})}))}),h)))}),[T,h,$,I]),te=(0,r.useCallback)((function(e,n){G.current&&clearTimeout(G.current),z((function(n){return(0,i.pi)((0,i.pi)({},n),{data:e,error:null,loading:!1})})),Q(e,n)}),[Q]),ie=(0,r.useCallback)((function(e,n){G.current&&clearTimeout(G.current),z((function(n){return(0,i.pi)((0,i.pi)({},n),{error:e,loading:!1})})),X(e,n)}),[X]),re=(0,r.useRef)();re.current||(re.current=new W(J,{cacheKey:T,cacheTime:C,persisted:I,formatResult:ee.current,onSuccess:te,onError:ie,onFinally:Y,onBefore:ne,debounceInterval:U,throttleInterval:j,pollingInterval:H,pollingWhenHidden:K,refreshOnWindowFocus:Z,focusTimespan:N})),(0,u.Z)((function(){re.current.updateOptions({cacheKey:T,cacheTime:C,persisted:I,formatResult:ee.current,onSuccess:te,onError:ie,onFinally:Y,onBefore:ne,debounceInterval:U,throttleInterval:j,pollingInterval:H,pollingWhenHidden:K,refreshOnWindowFocus:Z,focusTimespan:N})}),[Q,X,T,C,I,U,j,Y,$,H,K,Z,N,te,ie,ne]);var oe=(0,r.useCallback)((function(){for(var e,n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return(e=re.current).run.apply(e,(0,i.ev)([],(0,i.CR)(n),!1))}),[]),ue=(0,r.useCallback)((function(){return re.current.refresh()}),[]),se=(0,r.useCallback)((function(){re.current.cancel(),G.current&&clearTimeout(G.current),z((function(e){return(0,i.pi)((0,i.pi)({},e),{loading:!1})}))}),[]);return(0,u.Z)((function(){l&&Array.isArray(f)&&f.length>0&&ue()}),(0,i.ev)([l],(0,i.CR)(f),!1)),(0,r.useEffect)((function(){if(l){var e=Array.isArray(p)?p:void 0!==p?[p]:[];oe.apply(void 0,(0,i.ev)([],(0,i.CR)(e),!1))}return re.current.resume(),function(){se(),re.current.destroy(!1)}}),[]),(0,i.pi)((0,i.pi)({},q),{run:oe,cancel:se,mutate:function(e){z("function"==typeof e?function(n){return(0,i.pi)((0,i.pi)({},n),{data:e(q.data)})}:function(n){return(0,i.pi)((0,i.pi)({},n),{data:e})})},refresh:ue})}}}]);